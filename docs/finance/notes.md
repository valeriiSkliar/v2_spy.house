# Отложенная активация подписки (Queued Subscription)

## Описание

Поле `queued_subscription_id` в таблице `users` предназначено для реализации механизма отложенной активации подписки. Это позволяет пользователям приобретать новую подписку до истечения текущей, обеспечивая непрерывность обслуживания.

## Сценарий использования

1. У пользователя активна текущая подписка:

   - `subscription_id` не null
   - `subscription_is_expired = false`

2. Пользователь приобретает новую подписку до истечения текущей

3. Новая подписка сохраняется в `queued_subscription_id`

4. При истечении текущей подписки (cron job):
   - `subscription_id` → null или expired
   - `queued_subscription_id` → `subscription_id`
   - `queued_subscription_id` → null
   - Устанавливаются новые даты `subscription_time_start/end`

## Преимущества

✅ Пользователь не теряет оплаченную подписку  
✅ Плавный переход без перерывов в обслуживании  
✅ Возможность купить апгрейд заранее  
✅ Финансовая прозрачность - деньги списаны, подписка зарезервирована

## Пример

У пользователя подписка Premium до 01.02.2025. Он покупает 15.01.2025 подписку Enterprise. Enterprise сохраняется в `queued_subscription_id`, а 01.02.2025 автоматически активируется.

> Это стандартная практика для SaaS с непрерывным биллингом.
